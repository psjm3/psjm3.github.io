<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1" />
    <title>The globe of curiosity</title>

    <link rel="stylesheet" href="https://js.arcgis.com/4.12/esri/themes/light/main.css" />
    <link rel="stylesheet" href="./style.css" />

    <script>
      const locationPath = location.pathname.replace(/\/[^\/]+$/, "");
      dojoConfig = {
        packages: [{
          name: "utils",
          location: locationPath + "/utils"
        }],
        async: true
      };
    </script>
 
    <script src="https://js.arcgis.com/4.12/"></script>
    <script>
      require([
        "esri/Map",
        "esri/views/SceneView",
        "esri/layers/TileLayer",
        "esri/layers/GeoJSONLayer",
        "esri/Basemap",
        "utils/ExaggeratedElevationLayer",
        "esri/Graphic",
        "esri/geometry/Point"
      ], function (Map, SceneView, TileLayer, GeoJSONLayer, Basemap, ExaggeratedElevationLayer, Graphic, Point) {
        const R = 6358137; // approx radius of Earth in m
        const offset = 300000; // offset from the ground used for the clouds
        
        const basemap = new Basemap({
          baseLayers: [
            new TileLayer({
              url: "https://tiles.arcgis.com/tiles/nGt4QxSblgDfeJn9/arcgis/rest/services/terrain_with_heavy_bathymetry/MapServer"
            })
          ]
        });

        const map = new Map({
          basemap: basemap
        });

        const view = new SceneView({
          container: "viewDiv",
          map: map,
          alphaCompositingEnabled: true,
          qualityProfile: "high",
          camera: {
            position: [-55.03975781, 14.94826384, 19921223.30821],
            heading: 2.03,
            tilt: 0.13
          },
          popup: {
            dockEnabled: true,
            dockOptions: {
              position: "top-right",
              breakpoint: false,
              buttonEnabled: false
            },
            collapseEnabled: false
          },
          highlightOptions: {
            color: [255, 255, 255],
            haloOpacity: 0.5
          }
        });

        map.ground.layers = [new ExaggeratedElevationLayer({
          exaggerationBathymetry: 60,
          exaggerationTopography: 40
        })];

        const origin = new Point({
          x: 0, y: -90, z: -(2 * R)
        });

        const oceanSurface = new Graphic({
          geometry: origin,
          symbol: {
            type: "point-3d",
            symbolLayers: [{
              type: "object",
              resource: {
                href: "./sphere/scene.gltf"
              },
              width: 2 * R
            }]
          }
        });

        view.graphics.add(oceanSurface);

        const extremesLayer = new GeoJSONLayer({
          url: "extreme-points.geojson",
          elevationInfo: {
            mode: "absolute-height",
            offset: offset
          },
          renderer: {
            type: "simple",
            symbol: {
              type: "point-3d",
              symbolLayers: [{
                type: "icon",
                resource: { primitive: "circle" },
                material: { color: [0, 0, 0, 0] },
                outline: { color: [245, 99, 66, 1], size: 4 },
                size: 10
              }, {
                type: "icon",
                resource: { primitive: "circle" },
                material: { color: [0, 0, 0, 0] },
                outline: { color: [245, 99, 66, 1], size: 2 },
                size: 30
              }]
            }
          },

          popupTemplate: {
            title: "{name}",
            content: `
              <div class="popupImage">
                <img src="{imageUrl}" alt="{imageCaption}"/>
              </div>
              <div class="popupImageCaption">{imageCaption}</div>
              <div class="popupDescription">
                <p class="info">
                  <span class="esri-icon-favorites"></span> {type}
                </p>
                <p class="info">
                  <span class="esri-icon-map-pin"></span> {location}
                </p>
                <p class="info">
                  <span class="esri-icon-documentation"></span> {facts}
                </p>
              </div>
              <div class="popupCredits">
                Sources: <a href="{sourceUrl}" target="_blank">{source}</a> released under <a href="{sourceCopyrightUrl}">{sourceCopyright}</a>, <a href="{imageCopyrightUrl}" target="_blank">{imageCopyright}</a>.
              </div>
            `
          }
        });

        map.layers.add(extremesLayer);
 
      });
    </script>
  </head>

  <body>
    <div id="viewDiv"></div>
  </body>

</html>
